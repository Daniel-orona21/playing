<div class="ajustes-container">
  <h1>Preferencias</h1>

  <div class="user-profile">
    <div class="avatar"><h1>W</h1></div>
    <div class="username"><h1>Full wings!</h1></div>
    <span class="material-symbols-outlined">
        edit_square
    </span>
  </div>

  <h2>Vista</h2>
  <div class="contenedor">
    <div class="theme-setting">
        <span>Tema oscuro</span>
        <label class="switch">
          <input type="checkbox" checked>
          <span class="slider round"></span>
        </label>
      </div>
    
  </div>
  
  <h2>Cuenta</h2>
  <div class="contenedor">
    <ng-container *ngIf="establecimiento && !isEditingEst; else crearEstablecimiento">
      <div class="theme-setting">
        <span>Establecimiento</span>
        <span>{{ establecimiento.nombre }}</span>
      </div>
      <div class="theme-setting">
        <span>Ubicación</span>
        <span>{{ establecimiento.ubicacion || '-' }}</span>
      </div>
      <div class="theme-setting">
        <span>URL menú</span>
        <span>{{ establecimiento.url_menu || '-' }}</span>
      </div>
      <div class="action-row" (click)="editarEstablecimiento()">
        <span>Editar establecimiento</span>
        <span class="material-symbols-outlined">chevron_right</span>
      </div>
    </ng-container>
    <ng-template #crearEstablecimiento>
      <div class="form-establecimiento">
        <input type="text" placeholder="Nombre" [(ngModel)]="form.nombre">
        <input type="text" placeholder="Ubicación" [(ngModel)]="form.ubicacion">
        <input type="text" placeholder="URL del menú" [(ngModel)]="form.url_menu">
        <div class="form-actions">
          <button (click)="guardarEstablecimiento()">Guardar</button>
          <button class="secondary" *ngIf="establecimiento" (click)="cancelarEdicion()">Cancelar</button>
        </div>
      </div>
    </ng-template>

    <ng-container *ngIf="establecimiento">
      <div class="theme-setting">
        <span>Mesas</span>
        <div class="actions-inline">
          <button class="pill" (click)="crearMesaAuto()">Crear mesa</button>
          <button class="pill secondary" [disabled]="!mesas.length" (click)="eliminarUltimaMesa()">Eliminar última</button>
        </div>
      </div>
      <div class="lista-mesas" *ngIf="mesas.length; else sinMesas">
        <div class="mesa-item" *ngFor="let mesa of mesas">
          <span>Mesa {{ mesa.numero_mesa }}</span>
          <div class="mesa-actions">
            <button class="pill secondary" (click)="verQrMesa(mesa)">Ver QR</button>
            <span class="estado" [class.ocupada]="mesa.status === 'ocupada'">{{ mesa.status }}</span>
          </div>
        </div>
      </div>
      <ng-template #sinMesas>
        <div class="empty">Aún no hay mesas</div>
      </ng-template>
    </ng-container>

    <div class="qr-modal" *ngIf="showQr" (click)="cerrarQr()">
      <div class="qr-card" (click)="$event.stopPropagation()">
        <img *ngIf="qrUrl" [src]="qrUrl" alt="QR mesa" />
        <div class="form-actions">
          <a *ngIf="qrUrl" [href]="qrUrl" download="qr-mesa.png" class="pill">Descargar PNG</a>
          <button class="secondary" (click)="cerrarQr()">Cerrar</button>
        </div>
      </div>
    </div>
    <div class="action-row" (click)="onLogout()">
      <span>Cerrar sesión</span>
      <span class="material-symbols-outlined">chevron_right</span>
    </div>
  </div>
</div>

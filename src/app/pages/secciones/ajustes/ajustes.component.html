<div class="ajustes-container">
  <div class="seccion">
    <h1>Preferencias</h1>

  <div class="user-profile" *ngIf="establecimiento">
    <div class="avatar">
      <h1>{{ getInitials() }}</h1>
    </div>
    <div class="username">
      <h1>{{ getDisplayName() }}</h1>
    </div>
    
  </div>
  </div>

  <!-- <h2>Vista</h2>
  <div class="contenedor">
    <div class="theme-setting">
        <span>Tema oscuro</span>
        <label class="switch">
          <input type="checkbox" checked>
          <span class="slider round"></span>
        </label>
      </div>
    
  </div> -->
  
  <div class="seccion">
    <div class="header">
    <h1>Cuenta</h1>
    <div class="botonera">
      <div class="eliminacionContenedor" *ngIf="isEditingEst">
              <div class="tooltip-container">
                <button aria-describedby="cancel-tooltip" class="btnPequeño cancelar" (click)="cancelarEdicion()">
                  <span class="material-symbols-outlined">close</span>  
                </button>
                <div role="tooltip" id="cancel-tooltip" class="tooltip">
                  <strong>Cancelar</strong>
                </div>
              </div>
              <div class="tooltip-container">
                <button [disabled]="!isFormValid()" aria-describedby="delete-tooltip" class="btnPequeño" (click)="guardarEstablecimiento()">
                  <span class="material-symbols-outlined">check</span>
                </button>
                <div role="tooltip" id="delete-tooltip" class="tooltip">
                  <strong>Confirmar</strong>
                </div>
              </div>
            </div>
              <button *ngIf="establecimiento" class="btn-primary" [class.botonEliminarActivo]="isEditingEst" (click)="editarEstablecimiento()">
              <span class="material-symbols-outlined">edit_square</span>
              Editar
            </button>
            <button *ngIf="!establecimiento" [disabled]="!isFormValid()" aria-describedby="delete-tooltip" class="btn-inicial" (click)="guardarEstablecimiento()">
                  Confirmar
                </button>
    </div>
  </div>
  <div class="contenedor">
    <!-- Mensaje de completar cuenta cuando no hay establecimiento -->
    <div *ngIf="!establecimiento" class="completar-cuenta">
      <div class="completar-cuenta-header">
        <span class="material-symbols-outlined">account_circle</span>
        <h3>¡Completa tu cuenta!</h3>
      </div>
      <p>Para comenzar a usar el sistema, necesitas configurar tu establecimiento.</p>
    </div>

    <ng-container *ngIf="establecimiento && !isEditingEst; else crearEstablecimiento">
      <div class="theme-setting">
        <span>Establecimiento</span>
        <span>{{ establecimiento.nombre }}</span>
      </div>
      <div class="theme-setting">
        <span>Ubicación</span>
        <span>{{ establecimiento.ubicacion || '-' }}</span>
      </div>
      <div class="theme-setting">
        <span>URL menú</span>
        <span>{{ establecimiento.url_menu || '-' }}</span>
      </div>
    </ng-container>
    <ng-template #crearEstablecimiento>
      <div class="form-establecimiento">
        <div class="input-group">
            <input required="" type="text" id="nombreEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.nombre">
            <label class="user-label" for="nombreEstablecimiento">Nombre del establecimiento</label>
          </div>
          <div class="input-group">
            <input required="" type="text" id="ubicacionEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.ubicacion">
            <label class="user-label" for="ubicacionEstablecimiento">Ubicación</label>
          </div>
          <div class="input-group">
            <input required="" type="text" id="urlMenuEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.url_menu">
            <label class="user-label" for="urlMenuEstablecimiento">URL del menú</label>
          </div>
      </div>
    </ng-template>

    

   
   
  </div>
  </div>

  <ng-container *ngIf="establecimiento">
      <div class="seccion">
         <div class="header">
         <h1>Mesas</h1>
          <div class="actions-inline">
            <button class="btn-primary secondary eliminar" [disabled]="!mesas.length" (click)="eliminarUltimaMesa()">
              <span class="material-symbols-outlined">remove</span>Eliminar última</button>
            <button class="btn-primary" (click)="crearMesaAuto()">
              <span class="material-symbols-outlined">add</span>
              Crear mesa</button>
          </div>
       </div>
      <div class="lista-mesas" *ngIf="mesas.length; else sinMesas">
        <div class="mesa-item" *ngFor="let mesa of mesas">
          <span class="estado" [class.ocupada]="mesa.status === 'ocupada'">{{ mesa.status }}</span>
          <span class="numero" >{{ mesa.numero_mesa }}</span>
          <div class="qr-anchor" #anchor>
            <button class="botonqr" (click)="toggleQrTooltip($event, mesa, anchor)">
              <span class="material-symbols-outlined">qr_code</span>
            </button>
            <div class="qr-tooltip" *ngIf="openMesaId === mesa.id_mesa" @scaleInOut [class.right]="tooltipSide==='right'" [class.left]="tooltipSide==='left'" (click)="$event.stopPropagation()">
              <img *ngIf="qrUrl" [src]="qrUrl" alt="QR mesa" />
              <div class="form-actions">
                <a *ngIf="qrUrl" [href]="qrUrl" download="qr-mesa.png" class="pill">Descargar</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-template #sinMesas>
        <div class="empty">Aún no hay mesas</div>
      </ng-template>
      </div>
    </ng-container>

    

     <div class="seccion">
      <header>
        <h1>Salir</h1>
      </header>
    <div class="contenedor">
        <div class="action-row" (click)="onLogout()">
      <span>Cerrar sesión</span>
      <span class="material-symbols-outlined">chevron_right</span>
    </div>
    </div>
     </div>
</div>

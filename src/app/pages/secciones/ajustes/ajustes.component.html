<div class="ajustes-container">
  <h1>Preferencias</h1>

  <div class="user-profile" *ngIf="establecimiento">
    <div class="avatar">
      <h1>{{ getInitials() }}</h1>
    </div>
    <div class="username">
      <h1>{{ getDisplayName() }}</h1>
    </div>
    
  </div>

  <!-- <h2>Vista</h2>
  <div class="contenedor">
    <div class="theme-setting">
        <span>Tema oscuro</span>
        <label class="switch">
          <input type="checkbox" checked>
          <span class="slider round"></span>
        </label>
      </div>
    
  </div> -->
  
  <div class="header">
    <h1>Cuenta</h1>
    <div class="botonera">
      <div class="eliminacionContenedor" *ngIf="isEditingEst">
              <div class="tooltip-container">
                <button aria-describedby="cancel-tooltip" class="btnPequeño cancelar" (click)="cancelarEdicion()">
                  <span class="material-symbols-outlined">close</span>  
                </button>
                <div role="tooltip" id="cancel-tooltip" class="tooltip">
                  <strong>Cancelar</strong>
                </div>
              </div>
              <div class="tooltip-container">
                <button [disabled]="!isFormValid()" aria-describedby="delete-tooltip" class="btnPequeño" (click)="guardarEstablecimiento()">
                  <span class="material-symbols-outlined">check</span>
                </button>
                <div role="tooltip" id="delete-tooltip" class="tooltip">
                  <strong>Confirmar</strong>
                </div>
              </div>
            </div>
              <button class="btn-primary" [class.botonEliminarActivo]="isEditingEst" (click)="editarEstablecimiento()">
              <span class="material-symbols-outlined">edit_square</span>
              Editar
            </button>
    </div>
  </div>
  <div class="contenedor">
    <!-- Mensaje de completar cuenta cuando no hay establecimiento -->
    <div *ngIf="!establecimiento" class="completar-cuenta">
      <div class="completar-cuenta-header">
        <span class="material-symbols-outlined">account_circle</span>
        <h3>¡Completa tu cuenta!</h3>
      </div>
      <p>Para comenzar a usar el sistema, necesitas configurar tu establecimiento y tus datos personales.</p>
    </div>

    <ng-container *ngIf="establecimiento && !isEditingEst; else crearEstablecimiento">
      <div class="theme-setting">
        <span>Establecimiento</span>
        <span>{{ establecimiento.nombre }}</span>
      </div>
      <div class="theme-setting">
        <span>Ubicación</span>
        <span>{{ establecimiento.ubicacion || '-' }}</span>
      </div>
      <div class="theme-setting">
        <span>URL menú</span>
        <span>{{ establecimiento.url_menu || '-' }}</span>
      </div>
    </ng-container>
    <ng-template #crearEstablecimiento>
      <div class="form-establecimiento">
        <div class="input-group">
            <input required="" type="text" id="nombreEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.nombre">
            <label class="user-label" for="nombreEstablecimiento">Nombre del establecimiento</label>
          </div>
          <div class="input-group">
            <input required="" type="text" id="ubicacionEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.ubicacion">
            <label class="user-label" for="ubicacionEstablecimiento">Ubicación</label>
          </div>
          <div class="input-group">
            <input required="" type="text" id="urlMenuEstablecimiento" class="input" autocomplete="off" placeholder="" [(ngModel)]="form.url_menu">
            <label class="user-label" for="urlMenuEstablecimiento">URL del menú</label>
          </div>
      </div>
    </ng-template>

    

    <div class="qr-modal" *ngIf="showQr" (click)="cerrarQr()">
      <div class="qr-card" (click)="$event.stopPropagation()">
        <img *ngIf="qrUrl" [src]="qrUrl" alt="QR mesa" />
        <div class="form-actions">
          <a *ngIf="qrUrl" [href]="qrUrl" download="qr-mesa.png" class="pill">Descargar PNG</a>
          <button class="secondary" (click)="cerrarQr()">Cerrar</button>
        </div>
      </div>
    </div>
   
  </div>

  <ng-container *ngIf="establecimiento">
      <div class="theme-setting">
        <span>Mesas</span>
        <div class="actions-inline">
          <button class="pill" (click)="crearMesaAuto()">Crear mesa</button>
          <button class="pill secondary" [disabled]="!mesas.length" (click)="eliminarUltimaMesa()">Eliminar última</button>
        </div>
      </div>
      <div class="lista-mesas" *ngIf="mesas.length; else sinMesas">
        <div class="mesa-item" *ngFor="let mesa of mesas">
          <span>Mesa {{ mesa.numero_mesa }}</span>
          <div class="mesa-actions">
            <button class="pill secondary" (click)="verQrMesa(mesa)">Ver QR</button>
            <span class="estado" [class.ocupada]="mesa.status === 'ocupada'">{{ mesa.status }}</span>
          </div>
        </div>
      </div>
      <ng-template #sinMesas>
        <div class="empty">Aún no hay mesas</div>
      </ng-template>
    </ng-container>

     <div class="action-row" (click)="onLogout()">
      <span>Cerrar sesión</span>
      <span class="material-symbols-outlined">chevron_right</span>
    </div>
</div>
